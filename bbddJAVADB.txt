CREATE TABLE PRODUCTO (
  ID_PRODUCTO INTEGER NOT NULL GENERATED ALWAYS AS IDENTITY (START WITH 1, INCREMENT BY 1),
  NOMBRE VARCHAR(45) NOT NULL,
  DESCRIPCION VARCHAR(45),
  PRECIO_SALIDA DOUBLE NOT NULL,
  URL_FOTO VARCHAR(45),
  CATEGORIA INTEGER NOT NULL,
  PUBLICADOR INTEGER NOT NULL,
  EN_PROMOCION BOOLEAN NOT NULL,
  FECHA_INICIO_SUBASTA DATE NOT NULL,
  FECHA_FIN_SUBASTA DATE NOT NULL,
  COMPRADOR INTEGER,
  PRIMARY KEY (ID_PRODUCTO));

CREATE TABLE CATEGORIA (
  ID_CATEGORIA INTEGER NOT NULL GENERATED ALWAYS AS IDENTITY (START WITH 1, INCREMENT BY 1),
  NOMBRE VARCHAR(45) NOT NULL UNIQUE,
  PRIMARY KEY (ID_CATEGORIA));

CREATE TABLE CATEGORIA_PRODUCTO (
  PRODUCTO INTEGER NOT NULL,
  CATEGORIA INTEGER NOT NULL,
  PRIMARY KEY (PRODUCTO, CATEGORIA));


CREATE TABLE DIRECCION (
  ID_DIRECCION INTEGER NOT NULL GENERATED ALWAYS AS IDENTITY (START WITH 1, INCREMENT BY 1),
  TIPO VARCHAR(7) NOT NULL,
  CALLE VARCHAR(45) NOT NULL,
  NUMERO INTEGER NOT NULL,
  CODIGO_POSTAL INTEGER NOT NULL,
  PLANTA INTEGER,
  PUERTA VARCHAR(45),
  CONSTRAINT TIPO_VALIDO CHECK (TIPO IN ('OFICINA','CALLE')),
  PRIMARY KEY (ID_DIRECCION));

CREATE TABLE USUARIO (
  ID_USUARIO INTEGER NOT NULL GENERATED ALWAYS AS IDENTITY (START WITH 1, INCREMENT BY 1),
  NOMBRE_USUARIO VARCHAR(45) NOT NULL UNIQUE,
  CONTRASENYA VARCHAR(45) NOT NULL,
  EMAIL VARCHAR(45) NOT NULL,
  NOMBRE VARCHAR(45) NOT NULL,
  PRIMER_APELLIDO VARCHAR(45) NOT NULL,
  SEGUNDO_APELLIDO VARCHAR(45),
  DIRECCION INTEGER NOT NULL,
  FECHA_NACIMIENTO DATE,
  SEXO CHAR(1),
  TIPO_USUARIO INTEGER NOT NULL,
  CONSTRAINT SEXO_VALIDO CHECK (SEXO IN ('H','M')),
  PRIMARY KEY (ID_USUARIO));

CREATE TABLE ESTUDIO (
  ID_ESTUDIO INTEGER NOT NULL GENERATED ALWAYS AS IDENTITY (START WITH 1, INCREMENT BY 1),
  NOMBRE VARCHAR(45) NOT NULL,
  ANALISTA INTEGER NOT NULL,
  COMPRADOR BOOLEAN NOT NULL,
  VENDEDOR BOOLEAN NOT NULL,
  PRODUCTO BOOLEAN NOT NULL,
  DESCRIPCION VARCHAR(100),
  PRIMARY KEY (ID_ESTUDIO));

CREATE TABLE LISTA_PRODUCTO (
  PRODUCTO INTEGER NOT NULL,
  USUARIO INTEGER NOT NULL,
  PRIMARY KEY (PRODUCTO, USUARIO));

CREATE TABLE LISTA_USUARIO (
  ID_LISTA_USUARIO INTEGER NOT NULL GENERATED ALWAYS AS IDENTITY (START WITH 1, INCREMENT BY 1),
  NOMBRE VARCHAR(45) NOT NULL,
  PRIMARY KEY (ID_LISTA_USUARIO));

CREATE TABLE NOTIFICACION (
  ID_NOTIFICACION INTEGER NOT NULL GENERATED ALWAYS AS IDENTITY (START WITH 1, INCREMENT BY 1),
  NOTIFICANTE INTEGER NOT NULL,
  CONTENIDO VARCHAR(200) NOT NULL,
  FECHA_ENVIO DATE NOT NULL,
  PRIMARY KEY (ID_NOTIFICACION));

CREATE TABLE PUJA (
  ID_PUJA INTEGER NOT NULL GENERATED ALWAYS AS IDENTITY (START WITH 1, INCREMENT BY 1),
  COMPRADOR INTEGER NOT NULL,
  PRODUCTO INTEGER NOT NULL,
  CANTIDAD DOUBLE NOT NULL,
  PRIMARY KEY (ID_PUJA));

CREATE TABLE  TIPO_USUARIO (
  ID_TIPO_USUARIO INTEGER NOT NULL GENERATED ALWAYS AS IDENTITY (START WITH 1, INCREMENT BY 1),
  TIPO VARCHAR(45) NOT NULL UNIQUE,
  PRIMARY KEY (ID_TIPO_USUARIO));

CREATE TABLE USUARIO_LISTA_USUARIO (
  USUARIO INTEGER NOT NULL,
  LISTA INTEGER NOT NULL,
  PRIMARY KEY (USUARIO, LISTA));

CREATE TABLE CATEGORIAS_FAVORITAS(
  CATEGORIA INTEGER NOT NULL,
  USUARIO INTEGER NOT NULL,
  PRIMARY KEY (CATEGORIA,USUARIO)
);

CREATE TABLE DATOS_ESTUDIO_USUARIO(
	ID INTEGER NOT NULL,
NOMBRE BOOLEAN NOT NULL,
APELLIDOS BOOLEAN NOT NULL,
INGRESOS BOOLEAN NOT NULL,
ASCENDENTE BOOLEAN NOT NULL,
PRIMARY KEY(ID)
);

CREATE TABLE DATOS_ESTUDIO_PRODUCTO(
	ID INTEGER NOT NULL,
CATEGORIAS BOOLEAN NOT NULL,
VENDIDOS BOOLEAN NOT NULL,
PROMOCION BOOLEAN NOT NULL,
PRECIO_SALIDA DOUBLE,
PRECIO_ACTUAL DOUBLE,
PRIMARY KEY(ID)
);

CREATE TABLE USUARIO_NOTIFICACION(
  RECIBIDOR INTEGER NOT NULL,
  NOTIFICACION INTEGER NOT NULL,
  PRIMARY KEY (RECIBIDOR,NOTIFICACION)
);

ALTER TABLE CATEGORIAS_FAVORITAS
  ADD FOREIGN KEY (CATEGORIA) REFERENCES CATEGORIA (ID_CATEGORIA);
ALTER TABLE CATEGORIAS_FAVORITAS
  ADD FOREIGN KEY (USUARIO) REFERENCES USUARIO (ID_USUARIO);

ALTER TABLE USUARIO
  ADD FOREIGN KEY (DIRECCION) REFERENCES DIRECCION (ID_DIRECCION);
ALTER TABLE USUARIO
  ADD FOREIGN KEY (TIPO_USUARIO) REFERENCES TIPO_USUARIO (ID_TIPO_USUARIO);

ALTER TABLE ESTUDIO
  ADD FOREIGN KEY (ANALISTA) REFERENCES USUARIO (ID_USUARIO);

ALTER TABLE DATOS_ESTUDIO_USUARIO
  ADD FOREIGN KEY (ID) REFERENCES ESTUDIO (ID_ESTUDIO);
ALTER TABLE DATOS_ESTUDIO_PRODUCTO
  ADD FOREIGN KEY (ID) REFERENCES ESTUDIO (ID_ESTUDIO);

ALTER TABLE LISTA_PRODUCTO
  ADD FOREIGN KEY (PRODUCTO) REFERENCES PRODUCTO (ID_PRODUCTO);
ALTER TABLE LISTA_PRODUCTO
  ADD FOREIGN KEY (USUARIO) REFERENCES USUARIO (ID_USUARIO);

ALTER TABLE NOTIFICACION
  ADD FOREIGN KEY (NOTIFICANTE) REFERENCES USUARIO (ID_USUARIO);

ALTER TABLE USUARIO_LISTA_USUARIO
  ADD FOREIGN KEY (LISTA) REFERENCES LISTA_USUARIO (ID_LISTA_USUARIO);
ALTER TABLE USUARIO_LISTA_USUARIO
  ADD FOREIGN KEY (USUARIO) REFERENCES USUARIO (ID_USUARIO);

ALTER TABLE CATEGORIA_PRODUCTO
  ADD FOREIGN KEY (CATEGORIA) REFERENCES CATEGORIA (ID_CATEGORIA);
ALTER TABLE CATEGORIA_PRODUCTO
  ADD FOREIGN KEY (PRODUCTO) REFERENCES PRODUCTO (ID_PRODUCTO);

ALTER TABLE PUJA 
  ADD FOREIGN KEY (PRODUCTO) REFERENCES PRODUCTO (ID_PRODUCTO);
ALTER TABLE PUJA 
  ADD FOREIGN KEY (COMPRADOR) REFERENCES USUARIO (ID_USUARIO);